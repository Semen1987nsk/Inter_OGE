<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Touch Test - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Å–∞–Ω–∏–π</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #0f1429;
            color: #0f0;
            padding: 20px;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            color: #0ff;
        }
        
        .test-area {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, #1a1f3a, #2a2f4a);
            border: 3px solid #0f0;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            touch-action: none;
            cursor: grab;
        }
        
        .test-area.dragging {
            cursor: grabbing;
        }
        
        .draggable-item {
            position: absolute;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #0066cc, #0099ff);
            border: 2px solid #fff;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: grab;
            touch-action: none;
            user-select: none;
            transition: box-shadow 0.2s;
        }
        
        .draggable-item.dragging {
            cursor: grabbing;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
            z-index: 1000;
        }
        
        .log-area {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #0f0;
            padding-left: 10px;
        }
        
        .log-entry.error {
            color: #f00;
            border-left-color: #f00;
        }
        
        .log-entry.success {
            color: #0f0;
            border-left-color: #0f0;
        }
        
        .log-entry.warning {
            color: #ff0;
            border-left-color: #ff0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(0, 102, 204, 0.2);
            border: 2px solid #0066cc;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-label {
            color: #888;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .stat-value {
            color: #0ff;
            font-size: 24px;
            font-weight: bold;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #0099ff;
            transform: scale(1.05);
        }
        
        button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç Touch Diagnostics Test</h1>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞—Å–∞–Ω–∏–π –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏</p>
    </div>
    
    <div class="stats">
        <div class="stat-card">
            <div class="stat-label">Touch Starts</div>
            <div class="stat-value" id="stat-touchstart">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Touch Moves</div>
            <div class="stat-value" id="stat-touchmove">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Touch Ends</div>
            <div class="stat-value" id="stat-touchend">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Touch Cancels ‚ö†Ô∏è</div>
            <div class="stat-value" id="stat-touchcancel" style="color: #f00;">0</div>
        </div>
    </div>
    
    <div class="test-area" id="testArea">
        <div class="draggable-item" id="item1" style="left: 50px; top: 50px;">
            –ì–†–£–ó 1
        </div>
        <div class="draggable-item" id="item2" style="left: 200px; top: 50px;">
            –ì–†–£–ó 2
        </div>
        <div class="draggable-item" id="item3" style="left: 350px; top: 50px;">
            –ì–†–£–ó 3
        </div>
    </div>
    
    <div class="controls">
        <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        <button onclick="resetStats()">–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
        <button onclick="testTouch()">–¢–µ—Å—Ç –∫–∞—Å–∞–Ω–∏—è</button>
        <button onclick="location.reload()">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </div>
    
    <div class="log-area" id="logArea">
        <div class="log-entry success">‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –≥—Ä—É–∑—ã.</div>
    </div>
    
    <script>
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        const stats = {
            touchstart: 0,
            touchmove: 0,
            touchend: 0,
            touchcancel: 0
        };
        
        let draggedItem = null;
        let dragOffset = { x: 0, y: 0 };
        
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(message, type = 'success') {
            const logArea = document.getElementById('logArea');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const time = new Date().toLocaleTimeString('ru-RU', { 
                hour12: false, 
                fractionalSecondDigits: 3 
            });
            entry.textContent = `[${time}] ${message}`;
            logArea.insertBefore(entry, logArea.firstChild);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
            if (logArea.children.length > 50) {
                logArea.removeChild(logArea.lastChild);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats(type) {
            stats[type]++;
            document.getElementById(`stat-${type}`).textContent = stats[type];
        }
        
        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        function getCoords(e) {
            if (e.touches && e.touches.length > 0) {
                return { x: e.touches[0].clientX, y: e.touches[0].clientY };
            }
            if (e.changedTouches && e.changedTouches.length > 0) {
                return { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY };
            }
            return { x: e.clientX, y: e.clientY };
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≥—Ä—É–∑–æ–≤
        document.querySelectorAll('.draggable-item').forEach(item => {
            // Touch events
            item.addEventListener('touchstart', handleStart, { passive: false });
            // Mouse events (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞)
            item.addEventListener('mousedown', handleStart);
        });
        
        function handleStart(e) {
            e.preventDefault();
            
            const eventType = e.type;
            log(`${eventType} –Ω–∞ ${e.target.id}`, 'success');
            
            if (eventType === 'touchstart') {
                updateStats('touchstart');
            }
            
            draggedItem = e.target;
            draggedItem.classList.add('dragging');
            
            const coords = getCoords(e);
            const rect = draggedItem.getBoundingClientRect();
            dragOffset.x = coords.x - rect.left;
            dragOffset.y = coords.y - rect.top;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏
            window.addEventListener('touchmove', handleMove, { passive: false });
            window.addEventListener('touchend', handleEnd);
            window.addEventListener('touchcancel', handleCancel);
            window.addEventListener('mousemove', handleMove);
            window.addEventListener('mouseup', handleEnd);
        }
        
        function handleMove(e) {
            if (!draggedItem) return;
            e.preventDefault();
            
            if (e.type === 'touchmove') {
                updateStats('touchmove');
            }
            
            const coords = getCoords(e);
            const testArea = document.getElementById('testArea');
            const rect = testArea.getBoundingClientRect();
            
            let x = coords.x - rect.left - dragOffset.x;
            let y = coords.y - rect.top - dragOffset.y;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å
            x = Math.max(0, Math.min(x, rect.width - draggedItem.offsetWidth));
            y = Math.max(0, Math.min(y, rect.height - draggedItem.offsetHeight));
            
            draggedItem.style.left = x + 'px';
            draggedItem.style.top = y + 'px';
        }
        
        function handleEnd(e) {
            if (!draggedItem) return;
            e.preventDefault();
            
            const eventType = e.type;
            log(`${eventType} –Ω–∞ ${draggedItem.id}`, 'success');
            
            if (eventType === 'touchend') {
                updateStats('touchend');
            }
            
            draggedItem.classList.remove('dragging');
            draggedItem = null;
            
            // –£–¥–∞–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏
            window.removeEventListener('touchmove', handleMove);
            window.removeEventListener('touchend', handleEnd);
            window.removeEventListener('touchcancel', handleCancel);
            window.removeEventListener('mousemove', handleMove);
            window.removeEventListener('mouseup', handleEnd);
        }
        
        function handleCancel(e) {
            if (!draggedItem) return;
            
            log(`‚ö†Ô∏è TOUCHCANCEL –Ω–∞ ${draggedItem.id} - –ö–∞—Å–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –±—Ä–∞—É–∑–µ—Ä–æ–º!`, 'error');
            updateStats('touchcancel');
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –æ–±—ã—á–Ω—ã–π end
            handleEnd(e);
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function clearLog() {
            document.getElementById('logArea').innerHTML = '';
            log('–õ–æ–≥ –æ—á–∏—â–µ–Ω', 'success');
        }
        
        function resetStats() {
            stats.touchstart = 0;
            stats.touchmove = 0;
            stats.touchend = 0;
            stats.touchcancel = 0;
            Object.keys(stats).forEach(key => {
                document.getElementById(`stat-${key}`).textContent = '0';
            });
            log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞', 'success');
        }
        
        function testTouch() {
            const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
            const hasPointer = 'onpointerdown' in window;
            
            log(`Touch support: ${isTouchDevice}`, isTouchDevice ? 'success' : 'error');
            log(`Max touch points: ${navigator.maxTouchPoints}`, 'success');
            log(`Pointer events: ${hasPointer}`, hasPointer ? 'success' : 'warning');
            log(`User agent: ${navigator.userAgent}`, 'success');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
            testTouch();
        });
    </script>
</body>
</html>
